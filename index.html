<html>
  <head>
    <script type="text/javascript" src="https://cdn.jsdelivr.net/npm/web3@0.20.1/dist/web3.min.js"></script>
    <script type="text/javascript">
      window.addEventListener('load', () => {
        document.getElementById('page').innerHTML = 'Loaded!'

        let attempts = 0;
        const timer = setInterval(() => {
          const found = window.web3 && window.web3.currentProvider;

          attempts += 1;

          // stop at 10 attempts no matter what
          if (10 === attempts) {
            clearInterval(timer);

            if (!found) {
              alert('Unable to detect web3.currentProvider, tried 10 times!');
            }
          }

          if (found) {
            window.web3 = new Web3(window.web3.currentProvider);

            document.getElementById('web3').innerHTML = 'Detected!'

            const accounts = document.getElementById('accounts')
            const blockNumber = document.getElementById('blockNumber')

            window.web3.eth.getAccounts((err, value) => {
              if (err) {
                accounts.innerHTML = err.toString()
              } else {
                accounts.innerHTML = value.join(', ')
              }
            })

            window.web3.eth.getBlockNumber((err, value) => {
              if (err) {
                blockNumber.innerHTML = err.toString()
              } else {
                blockNumber.innerHTML = value
              }
            })
          }
        }, 100)
      })
    </script>
  </head>
  <body>
    <p>
      <strong>Page:</strong>
      <span id="page" />
    </p>
    <p>
      <strong>web3:</strong>
      <span id="web3">waiting...</span>
    </p>
    <p>
      <strong>Block num:</strong>
      <span id="blockNumber" />
    </p>
    <p>
      <strong>Accounts:</strong>
      <span id="accounts" />
    </p>
  </body>
</html>
